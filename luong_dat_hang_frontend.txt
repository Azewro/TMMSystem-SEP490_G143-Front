PHẦN 1: MÔ TẢ CHI TIẾT LUỒNG ĐẶT HÀNG
======================================

Dưới đây là mô tả chi tiết các bước trong luồng đặt hàng từ khi khách hàng tạo yêu cầu cho đến khi lên kế hoạch sản xuất, dựa trên tài liệu quy trình.

**GIAI ĐOẠN 1: TẠO YÊU CẦU BÁO GIÁ (RFQ) VÀ XÁC NHẬN**
----------------------------------------------------

Mục tiêu: Khách hàng tạo một Yêu cầu báo giá (RFQ) và nhân viên Sales xác nhận lại thông tin trước khi chuyển cho bộ phận Kế hoạch.

*   **CÁC LUỒNG TẠO RFQ:**

    1.  **Khách hàng đã có tài khoản:**
        *   Khách hàng đăng nhập vào hệ thống.
        *   Tạo RFQ. Hệ thống sẽ tự động điền các thông tin cá nhân (tên, sđt, email...). Khách hàng chỉ cần nhập sản phẩm, số lượng, ngày giao mong muốn.
        *   **Quan trọng:** Khách hàng có quyền chỉnh sửa lại các thông tin được tự động điền.

    2.  **Khách hàng lần đầu sử dụng (Khách vãng lai):**
        *   Khách hàng truy cập trang chủ (chưa đăng nhập).
        *   Vẫn có thể tạo RFQ nhưng phải điền tất cả thông tin từ đầu.

    3.  **Sales tạo hộ:**
        *   Áp dụng cho khách hàng không sử dụng hệ thống, liên hệ trực tiếp với Sales.
        *   Sales sẽ đăng nhập và tạo một RFQ thay cho khách hàng.

*   **PHÂN CÔNG VÀ XÁC NHẬN (NỘI BỘ):**

    4.  **Giám đốc phân công:**
        *   Nếu RFQ được tạo mà không có "Mã nhân viên sale", Giám đốc sẽ nhận được thông báo.
        *   Giám đốc sẽ chỉ định một nhân viên **Sales** và một bộ phận **Kế hoạch** để xử lý RFQ này.

    5.  **Sales xác nhận RFQ:**
        *   Sales nhận được RFQ đã được phân công cho mình.
        *   **Quyền chỉnh sửa của khách hàng:** Tại thời điểm này, khách hàng vẫn có thể tự do chỉnh sửa RFQ của mình.
        *   Sales thực hiện gọi điện (ngoài hệ thống) để xác nhận lại các yêu cầu với khách hàng.
        *   Nếu khách hàng muốn thay đổi, Sales có thể thay đổi giúp họ trực tiếp trên hệ thống.
        *   Sau khi đã chốt thông tin, Sales nhấn nút **"Xác nhận"**.
        *   **Quan trọng:** Kể từ lúc Sales nhấn "Xác nhận", khách hàng sẽ **không thể chỉnh sửa** RFQ đó nữa. RFQ được chuyển cho bộ phận Kế hoạch.

**GIAI ĐOẠN 2: KIỂM TRA NĂNG LỰC VÀ TẠO BÁO GIÁ**
---------------------------------------------------

Mục tiêu: Bộ phận Kế hoạch kiểm tra khả năng đáp ứng của nhà máy và tạo ra một Báo giá chính thức.

*   **KIỂM TRA NĂNG LỰC SẢN XUẤT:**

    6.  **Bộ phận Kế hoạch:**
        *   Nhận được RFQ đã được Sales xác nhận.
        *   Tiến hành kiểm tra năng lực sản xuất, bao gồm: lịch hoạt động của máy móc, tình trạng tồn kho nguyên vật liệu.

*   **XỬ LÝ KẾT QUẢ KIỂM TRA:**

    7.  **Trường hợp 1: ĐỦ NĂNG LỰC SẢN XUẤT**
        *   **Kế hoạch:** Tiến hành bước tiếp theo là tạo báo giá.

    8.  **Trường hợp 2: KHÔNG ĐỦ NĂNG LỰC SẢN XUẤT**
        *   **Kế hoạch:** Mở một form trên hệ thống và điền lý do không đủ năng lực (ví dụ: "Lịch máy dệt đã đầy, ngày sản xuất khả thi sớm nhất là...").
        *   **Hệ thống:** Tự động gửi thông báo này cho Sales.
        *   **Sales:** Nhận thông báo, gọi điện thương lượng lại ngày giao hàng mới với khách hàng.
            *   **Nếu khách hàng đồng ý:** Sales cập nhật lại ngày giao hàng mong muốn mới trên RFQ. Luồng quay lại bước 6 để Kế hoạch tiếp tục.
            *   **Nếu khách hàng không đồng ý:** Sales đóng RFQ với lý do "Khách hàng không đồng ý ngày giao hàng mới". Luồng kết thúc.

*   **TẠO VÀ GỬI BÁO GIÁ:**

    9.  **Kế hoạch & Hệ thống:**
        *   Sau khi xác định đủ năng lực, Kế hoạch tiến hành tạo báo giá trên hệ thống.
        *   Hệ thống sẽ gửi Báo giá này đến cho cả Sales và Khách hàng.
        *   Đối với khách hàng mới hoặc được Sales tạo hộ, hệ thống sẽ gửi kèm **thông tin đăng nhập** (tài khoản và mật khẩu tạm thời) qua email/sdt để họ truy cập xem báo giá.

**GIAI ĐOẠN 3: PHÊ DUYỆT BÁO GIÁ VÀ HỢP ĐỒNG**
-------------------------------------------------

Mục tiêu: Khách hàng phê duyệt báo giá và các bên ký kết, phê duyệt hợp đồng chính thức.

*   **KHÁCH HÀNG PHÊ DUYỆT BÁO GIÁ:**

    10. **Khách hàng:**
        *   Truy cập vào hệ thống (nếu là lần đầu sẽ phải đổi mật khẩu).
        *   Xem chi tiết báo giá.
        *   **Lựa chọn 1: Chấp nhận báo giá:**
            *   Hệ thống hiển thị một form để khách hàng điền/xác nhận các thông tin pháp lý còn thiếu để làm hợp đồng.
            *   Sau khi điền xong, hệ thống tự động tạo một **Đơn hàng (Order)**.
        *   **Lựa chọn 2: Từ chối báo giá:** Luồng kết thúc.

*   **UPLOAD VÀ PHÊ DUYỆT HỢP ĐỒNG:**

    11. **Sales:**
        *   Nhận thông báo khi khách hàng đã chấp nhận báo giá.
        *   Tiến hành ký kết hợp đồng giấy (ngoài hệ thống).
        *   **Upload file PDF hợp đồng** đã ký lên Đơn hàng tương ứng trên hệ thống.

    12. **Giám đốc:**
        *   Nhận thông báo có hợp đồng mới cần duyệt.
        *   Xem file PDF hợp đồng.
        *   **Lựa chọn 1: Phê duyệt hợp đồng:** Đơn hàng được duyệt.
        *   **Lựa chọn 2: Từ chối hợp đồng:** Gửi trả lại cho Sales kèm lý do. Sales phải làm lại hợp đồng, upload file mới và trình duyệt lại.

**GIAI ĐOẠN 4: LẬP KẾ HOẠCH SẢN XUẤT VÀ THỰC THI**
----------------------------------------------------

Mục tiêu: Lập kế hoạch sản xuất chi tiết, được Giám đốc phê duyệt và chuyển đi sản xuất.

*   **GỘP ĐƠN VÀ LẬP KẾ HOẠCH:**

    13. **Hệ thống (Tự động):**
        *   Sau khi hợp đồng được duyệt, hệ thống sẽ tự động quét và **gộp các đơn hàng** có cùng tiêu chí (cùng sản phẩm, ngày giao gần nhau...) thành một **Lô sản xuất**.

    14. **Bộ phận Kế hoạch:**
        *   Nhận thông báo về các lô sản xuất đã được gộp.
        *   Dựa trên thông tin lô, tiến hành **lập Kế hoạch sản xuất chi tiết** (phân bổ máy móc, nhân sự, thời gian cho từng công đoạn).
        *   Gửi kế hoạch sản xuất cho Giám đốc duyệt.

*   **PHÊ DUYỆT VÀ SẢN XUẤT:**

    15. **Giám đốc:**
        *   Xem xét kế hoạch sản xuất chi tiết.
        *   **Lựa chọn 1: Phê duyệt:** Trạng thái đơn hàng chuyển thành "Approved".
        *   **Lựa chọn 2: Từ chối:** Gửi trả lại cho Kế hoạch để chỉnh sửa và trình duyệt lại.

    16. **Hệ thống (Tự động):**
        *   Ngay sau khi Giám đốc duyệt kế hoạch sản xuất, hệ thống tự động tạo ra **Lệnh sản xuất (Production Order)**.

    17. **Quản lý sản xuất:**
        *   Nhận Lệnh sản xuất và phân công để bắt đầu quá trình sản xuất thực tế.